(window.webpackJsonp=window.webpackJsonp||[]).push([[304],{1085:function(e,t,n){"use strict";var a=n(325),r=n.n(a),s=n(2),i=n(310),c=n(315),o=n.n(c),l=n(5),d=n(309),u=n(494),p=n.n(u),h=n(697),m=n(751),g=n(752);function b(e){let t=e.event;return Object(g.b)(t)?s.createElement(g.a,{event:t}):Object(m.b)(t)?s.createElement(h.a.Consumer,null,e=>{let n=e.branchLike;return s.createElement(m.a,{branchLike:n,event:t})}):s.createElement("div",{className:"project-activity-event-inner"},s.createElement("div",{className:"project-activity-event-inner-main"},s.createElement(p.a,{className:d("project-activity-event-icon","little-spacer-right",t.category)}),s.createElement("span",{className:"project-activity-event-inner-text"},s.createElement("span",{className:"note little-spacer-right"},Object(l.translate)("event.category",t.category),":"),s.createElement("strong",{title:t.description},t.name))))}var y=n(340),v=n.n(y);class f extends s.PureComponent{constructor(e){super(e),this.changeInput=e=>{this.setState({name:e.target.value})},this.handleSubmit=()=>this.props.changeEvent(this.props.event.key,this.state.name),this.state={name:e.event.name}}render(){const e=this.state.name;return s.createElement(v.a,{confirmButtonText:Object(l.translate)("change_verb"),confirmDisable:!e||e===this.props.event.name,header:this.props.header,onClose:this.props.onClose,onConfirm:this.handleSubmit,size:"small"},s.createElement("div",{className:"modal-field"},s.createElement("label",null,Object(l.translate)("name")),s.createElement("input",{autoFocus:!0,onChange:this.changeInput,type:"text",value:e})))}}class S extends s.PureComponent{constructor(){super(...arguments),this.handleSubmit=()=>this.props.deleteEvent(this.props.analysis,this.props.event.key)}render(){return s.createElement(v.a,{confirmButtonText:Object(l.translate)("delete"),header:this.props.header,isDestructive:!0,onClose:this.props.onClose,onConfirm:this.handleSubmit},Object(l.translate)(this.props.removeEventQuestion))}}class E extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={changing:!1,deleting:!1},this.startChanging=()=>{this.setState({changing:!0})},this.stopChanging=()=>{this.mounted&&this.setState({changing:!1})},this.startDeleting=()=>{this.setState({deleting:!0})},this.stopDeleting=()=>{this.mounted&&this.setState({deleting:!1})}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=this.props,t=e.event,n=e.canAdmin,a="OTHER"===t.category,r=!a&&"VERSION"===t.category,c=a||r,d=a||r&&!this.props.isFirst,u=n&&(c||d);return s.createElement("div",{className:"project-activity-event"},s.createElement(b,{event:this.props.event}),u&&s.createElement("div",{className:"project-activity-event-actions spacer-left"},c&&s.createElement(o.a,{overlay:Object(l.translate)("project_activity.events.tooltip.edit")},s.createElement(i.EditButton,{className:"js-change-event button-small",onClick:this.startChanging})),d&&s.createElement(o.a,{overlay:Object(l.translate)("project_activity.events.tooltip.delete")},s.createElement(i.DeleteButton,{className:"js-delete-event button-small",onClick:this.startDeleting}))),this.state.changing&&s.createElement(f,{changeEvent:this.props.changeEvent,event:this.props.event,header:r?Object(l.translate)("project_activity.change_version"):Object(l.translate)("project_activity.change_custom_event"),onClose:this.stopChanging}),this.state.deleting&&s.createElement(S,{analysis:this.props.analysis,deleteEvent:this.props.deleteEvent,event:this.props.event,header:r?Object(l.translate)("project_activity.remove_version"):Object(l.translate)("project_activity.remove_custom_event"),onClose:this.stopDeleting,removeEventQuestion:"project_activity.".concat(r?"remove_version":"remove_custom_event",".question")}))}}function j(e){const t=r()(e.events,e=>"VERSION"===e.category?1:0,"category");return s.createElement("div",{className:"project-activity-events"},t.map(t=>s.createElement(E,{analysis:e.analysis,canAdmin:e.canAdmin,changeEvent:e.changeEvent,deleteEvent:e.deleteEvent,event:t,isFirst:e.isFirst,key:t.key})))}n.d(t,"a",function(){return j})},1677:function(e,t,n){var a=n(1678);"string"==typeof a&&(a=[[e.i,a,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(313)(a,r);a.locals&&(e.exports=a.locals)},1678:function(e,t,n){(e.exports=n(312)(!1)).push([e.i,".project-baseline{padding:32px}.project-baseline-selector>.branch-baseline-setting-modal{max-height:60vh;padding-top:2px}.project-baseline-selector .general-setting{margin-left:7px}.branch-baseline-selector>hr{margin:0 -32px 32px}.branch-analysis-list-wrapper,.branch-baseline-setting-modal{display:flex;flex-direction:column}.branch-analysis-list-wrapper{overflow:hidden;position:relative;min-height:200px}.branch-analysis-list{overflow-y:auto;padding-left:12px;padding-right:15px;min-height:50px}.branch-analysis-list>ul{padding-top:18px}.branch-analysis-date{margin-bottom:16px;font-size:15px;font-weight:700}.branch-analysis-day{margin-top:8px;margin-bottom:24px}.branch-analysis{display:flex;justify-content:space-between;cursor:pointer;padding:8px;border-top:1px solid #e6e6e6;border-bottom:1px solid #e6e6e6}.branch-analysis+.branch-analysis{border-top:none}.branch-analysis:hover{background-color:#cae3f2}.branch-analysis>.project-activity-events{flex:1 0 50%}.branch-analysis-time{width:150px}.branch-analysis-version-badge{margin-left:-12px;padding-top:8px;padding-bottom:8px;background-color:#fff}.branch-analysis-version-badge.sticky+.branch-analysis-days-list{padding-top:36px}.branch-analysis-version-badge.first,.branch-analysis-version-badge.sticky{position:absolute;top:1px;left:13px;right:16px;padding-top:24px;z-index:1}.branch-analysis-version-badge .badge{max-width:385px;border-radius:0 2px 2px 0;font-weight:700;font-size:12px;letter-spacing:0;overflow:hidden;text-overflow:ellipsis}.project-activity-event-icon.VERSION{color:#4b9fd5}.project-activity-event-icon.QUALITY_GATE{color:#9139d4}.project-activity-event-icon.QUALITY_PROFILE{color:#ccc}.project-activity-event-icon.DEFINITION_CHANGE{color:#33a759}.project-activity-event-icon.OTHER{color:#442d1b}.invisible{visibility:hidden}",""])},1796:function(e,t,n){"use strict";n.r(t);var a=n(316),r=n(318),s=n(2),i=n(304),c=n(28),o=n(314),l=n.n(o),d=n(5),u=n(783),p=n(332),h=(n(1677),n(784)),m=n(373),g=n.n(m),b=n(599),y=n(344),v=n(328),f=n(310),S=n(326),E=n.n(S),j=n(29),O=n(448),_=n.n(O);function N(e){let t=e.disabled,n=e.onSelect,a=e.selected;return s.createElement(_.a,{disabled:t,onClick:()=>n("SPECIFIC_ANALYSIS"),selected:a,title:Object(d.translate)("baseline.specific_analysis")},s.createElement("p",{className:"big-spacer-bottom"},Object(d.translate)("baseline.specific_analysis.description")))}var C=n(830),k=n(831),x=n(522),A=n.n(x),P=n(309),D=n(972),I=n(336),w=n.n(I),R=n(315),F=n.n(R),L=n(429),V=n(749),B=n(342),T=n(580),M=n(1085),U=n(481);function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class G extends s.PureComponent{constructor(e){super(e),this.mounted=!1,this.badges={},this.state={analyses:[],loading:!0,range:30,scroll:0},this.handleScroll=e=>{e.currentTarget&&this.updateScroll(e.currentTarget.scrollTop)},this.updateScroll=e=>{this.setState({scroll:e})},this.registerBadgeNode=e=>t=>{t&&(t.getAttribute("originOffsetTop")||t.setAttribute("originOffsetTop",String(t.offsetTop)),this.badges[e]=t)},this.shouldStick=e=>{const t=this.badges[e];return t&&Number(t.getAttribute("originOffsetTop"))<this.state.scroll+10},this.handleRangeChange=e=>{let t=e.value;this.setState({range:t},()=>this.fetchAnalyses())},this.rootNodeRef=s.createRef(),this.updateScroll=A()(this.updateScroll,20)}componentDidMount(){this.mounted=!0,this.fetchAnalyses(!0)}componentWillUnmount(){this.mounted=!1}scrollToSelected(){const e=document.querySelector(".branch-analysis.selected");this.rootNodeRef.current&&e&&Object(L.scrollToElement)(e,{parent:this.rootNodeRef.current,bottomOffset:40})}fetchAnalyses(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.props,n=t.analysis,a=t.branch,r=t.component,s=this.state.range;return this.setState({loading:!0}),Object(V.e)({branch:a,project:r,from:s?Object(j.toShortNotSoISOString)(Object(D.subDays)(new Date,s)):void 0}).then(t=>{e&&n&&!t.analyses.find(e=>e.key===n)?this.handleRangeChange({value:0}):this.setState({analyses:t.analyses.map(e=>(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){Y(e,t,n[t])})}return e})({},e,{date:Object(j.parseDate)(e.date)})),loading:!1},()=>{this.scrollToSelected()})})}getRangeOptions(){return[{label:Object(d.translate)("baseline.branch_analyses.ranges.30days"),value:30},{label:Object(d.translate)("baseline.branch_analyses.ranges.allTime"),value:0}]}render(){const e=this.state,t=e.analyses,n=e.loading,a=e.range,r=Object(U.k)(t,{category:"",customMetrics:[],graph:"",project:this.props.component}),i=r.length>1||1===r.length&&Object.keys(r[0].byDay).length>0;return s.createElement(s.Fragment,null,s.createElement("div",{className:"spacer-bottom"},Object(d.translate)("baseline.analysis_from"),s.createElement(w.a,{autoBlur:!0,className:"input-medium spacer-left",clearable:!1,onChange:this.handleRangeChange,options:this.getRangeOptions(),searchable:!1,value:a})),s.createElement("div",{className:"branch-analysis-list-wrapper"},s.createElement("div",{className:"bordered branch-analysis-list",onScroll:this.handleScroll,ref:this.rootNodeRef},n&&s.createElement(l.a,{className:"big-spacer-top"}),n||i?s.createElement("ul",null,r.map((e,n)=>{const a=Object.keys(e.byDay);return a.length<=0?null:s.createElement("li",{key:e.key||"noversion"},e.version&&s.createElement("div",{className:P("branch-analysis-version-badge",{first:0===n,sticky:this.shouldStick(e.version)}),ref:this.registerBadgeNode(e.version)},s.createElement(F.a,{mouseEnterDelay:.5,overlay:"".concat(Object(d.translate)("version")," ").concat(e.version)},s.createElement("span",{className:"badge"},e.version))),s.createElement("ul",{className:"branch-analysis-days-list"},a.map(n=>s.createElement("li",{className:"branch-analysis-day","data-day":Object(j.toShortNotSoISOString)(Number(n)),key:n},s.createElement("div",{className:"branch-analysis-date"},s.createElement(B.a,{date:Number(n),long:!0})),s.createElement("ul",{className:"branch-analysis-analyses-list"},null!=e.byDay[n]&&e.byDay[n].map(e=>s.createElement("li",{className:P("branch-analysis",{selected:e.key===this.props.analysis}),"data-date":Object(j.parseDate)(e.date).valueOf(),key:e.key,onClick:()=>this.props.onSelectAnalysis(e)},s.createElement("div",{className:"branch-analysis-time spacer-right"},s.createElement(T.a,{date:Object(j.parseDate)(e.date),long:!1},t=>s.createElement("time",{className:"text-middle",dateTime:Object(j.parseDate)(e.date).toISOString()},t))),e.events.length>0&&s.createElement(M.a,{analysis:e.key,changeEvent:()=>Promise.resolve(),deleteEvent:()=>Promise.resolve(),events:e.events,isFirst:t[0].key===e.key}),s.createElement("div",{className:"analysis-selection-button"},s.createElement("i",{className:P("icon-radio",{"is-checked":e.key===this.props.analysis})})))))))))})):s.createElement("div",{className:"big-spacer-top big-spacer-bottom strong"},Object(d.translate)("baseline.no_analyses")))))}}class q extends s.PureComponent{constructor(e){super(e),this.mounted=!1,this.handleSubmit=e=>{e.preventDefault();const t=this.props,n=t.branch,a=t.component,r=this.state,s=r.analysis,i=r.analysisDate,c=r.days,o=r.selected,l=Object(h.a)({type:o,analysis:s,days:c});o&&(this.setState({saving:!0}),Object(u.d)({project:a,type:o,value:l,branch:n.name}).then(()=>{this.setState({saving:!1}),this.props.onClose(n.name,{type:o,value:l,effectiveValue:i&&Object(j.toNotSoISOString)(i)})},()=>{this.setState({saving:!1})}))},this.requestClose=()=>this.props.onClose(),this.handleSelectAnalysis=e=>this.setState({analysis:e.key,analysisDate:e.date}),this.handleSelectDays=e=>this.setState({days:e}),this.handleSelectSetting=e=>this.setState({selected:e}),this.state={analysis:this.getValueFromProps("SPECIFIC_ANALYSIS")||"",days:this.getValueFromProps("NUMBER_OF_DAYS")||"30",saving:!1,selected:this.props.branch.newCodePeriod&&this.props.branch.newCodePeriod.type}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}getValueFromProps(e){return this.props.branch.newCodePeriod&&this.props.branch.newCodePeriod.type===e?this.props.branch.newCodePeriod.value:null}render(){const e=this.props.branch,t=this.state,n=t.analysis,a=t.days,r=t.saving,i=t.selected,c=Object(d.translateWithParameters)("baseline.new_code_period_for_branch_x",e.name),o=e.newCodePeriod&&e.newCodePeriod.type,u=e.newCodePeriod&&e.newCodePeriod.value,p=Object(h.c)({analysis:n,currentSetting:o,currentSettingValue:u,days:a,selected:i}),m=p.isChanged,g=p.isValid;return s.createElement(E.a,{contentLabel:c,onRequestClose:this.requestClose,size:"large"},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,c)),s.createElement("form",{onSubmit:this.handleSubmit},s.createElement("div",{className:"modal-body modal-container branch-baseline-setting-modal"},s.createElement("div",{className:"display-flex-row huge-spacer-bottom",role:"radiogroup"},s.createElement(k.a,{isDefault:!1,onSelect:this.handleSelectSetting,selected:"PREVIOUS_VERSION"===i}),s.createElement(C.a,{days:a,isChanged:m,isValid:g,onChangeDays:this.handleSelectDays,onSelect:this.handleSelectSetting,selected:"NUMBER_OF_DAYS"===i}),s.createElement(N,{onSelect:this.handleSelectSetting,selected:"SPECIFIC_ANALYSIS"===i})),"SPECIFIC_ANALYSIS"===i&&s.createElement(G,{analysis:n,branch:e.name,component:this.props.component,onSelectAnalysis:this.handleSelectAnalysis})),s.createElement("footer",{className:"modal-foot"},s.createElement(l.a,{className:"spacer-right",loading:r}),s.createElement(f.SubmitButton,{disabled:!m||r||!g},Object(d.translate)("save")),s.createElement(f.ResetButtonLink,{onClick:this.props.onClose},Object(d.translate)("cancel")))))}}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class H extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={branches:[],loading:!0},this.updateBranchNewCodePeriod=(e,t)=>{const n=this.state.branches,a=n.find(t=>t.name===e);return a&&(a.newCodePeriod=t),n.slice(0)},this.openEditModal=e=>{this.setState({editedBranch:e})},this.closeEditModal=(e,t)=>{e?this.setState({branches:this.updateBranchNewCodePeriod(e,t),editedBranch:void 0}):this.setState({editedBranch:void 0})}}componentDidMount(){this.mounted=!0,this.fetchBranches()}componentWillUnmount(){this.mounted=!1}sortAndFilterBranches(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(v.j)(e.filter(v.f))}fetchBranches(){const e=this.props.component.key;this.setState({loading:!0});const t=this.sortAndFilterBranches(this.props.branchLikes);Object(u.b)({project:e}).then(e=>{const n=e.newCodePeriods?e.newCodePeriods.filter(e=>!e.inherited):[],a=t.map(e=>{const t=n.find(t=>t.branchKey===e.name);if(!t)return e;const a=t.type,r=void 0===a?"PREVIOUS_VERSION":a,s=t.value,i=t.effectiveValue;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){z(e,t,n[t])})}return e}({},e,{newCodePeriod:{type:r,value:s,effectiveValue:i}})});this.setState({branches:a,loading:!1})},()=>{this.setState({loading:!1})})}resetToDefault(e){return Object(u.c)({project:this.props.component.key,branch:e}).then(()=>{this.setState({branches:this.updateBranchNewCodePeriod(e,void 0)})})}renderNewCodePeriodSetting(e){switch(e.type){case"SPECIFIC_ANALYSIS":return s.createElement(s.Fragment,null,"".concat(Object(d.translate)("baseline.specific_analysis"),": "),e.effectiveValue?s.createElement(y.a,{date:e.effectiveValue}):"?");case"NUMBER_OF_DAYS":return"".concat(Object(d.translate)("baseline.number_days"),": ").concat(e.value);case"PREVIOUS_VERSION":return Object(d.translate)("baseline.previous_version");default:return e.type}}render(){const e=this.state,t=e.branches,n=e.editedBranch,a=e.loading;return t.length<1?null:a?s.createElement(l.a,null):s.createElement(s.Fragment,null,s.createElement("table",{className:"data zebra"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,Object(d.translate)("branch_list.branch")),s.createElement("th",{className:"nowrap huge-spacer-right"},Object(d.translate)("branch_list.current_setting")),s.createElement("th",{className:"thin nowrap"},Object(d.translate)("branch_list.actions")))),s.createElement("tbody",null,t.map(e=>s.createElement("tr",{key:e.name},s.createElement("td",{className:"nowrap"},s.createElement(b.a,{branchLike:e,className:"little-spacer-right"}),e.name,e.isMain&&s.createElement("div",{className:"badge spacer-left"},Object(d.translate)("branches.main_branch"))),s.createElement("td",{className:"huge-spacer-right nowrap"},e.newCodePeriod?this.renderNewCodePeriodSetting(e.newCodePeriod):Object(d.translate)("branch_list.default_setting")),s.createElement("td",{className:"text-right"},s.createElement(g.a,null,s.createElement(m.ActionsDropdownItem,{onClick:()=>this.openEditModal(e)},Object(d.translate)("edit")),e.newCodePeriod&&s.createElement(m.ActionsDropdownItem,{onClick:()=>this.resetToDefault(e.name)},Object(d.translate)("reset_to_default")))))))),n&&s.createElement(q,{branch:n,component:this.props.component.key,onClose:this.closeEditModal}))}}var Q=n(730),W=n.n(Q);function J(e){const t=e.analysis,n=e.branchesEnabled,a=e.component,r=e.currentSetting,i=e.currentSettingValue,c=e.days,o=e.generalSetting,u=e.saving,p=e.selected,m=e.overrideGeneralSetting,g=Object(h.c)({analysis:t,currentSetting:r,currentSettingValue:i,days:c,selected:p,overrideGeneralSetting:m}),b=g.isChanged,y=g.isValid;return s.createElement("form",{className:"project-baseline-selector",onSubmit:e.onSubmit},s.createElement("div",{className:"big-spacer-top spacer-bottom",role:"radiogroup"},s.createElement(W.a,{checked:!m,className:"big-spacer-bottom",onCheck:()=>e.onToggleSpecificSetting(!1),value:"general"},Object(d.translate)("project_baseline.general_setting")),s.createElement("div",{className:"big-spacer-left"},function(e){let t,n;return"NUMBER_OF_DAYS"===e.type?(t="".concat(Object(d.translate)("baseline.number_days")," (").concat(Object(d.translateWithParameters)("duration.days",e.value||"?"),")"),n=Object(d.translate)("baseline.number_days.description")):(t=Object(d.translate)("baseline.previous_version"),n=Object(d.translate)("baseline.previous_version.description")),s.createElement("div",{className:"general-setting"},s.createElement("strong",null,t),": ",n)}(o)),s.createElement(W.a,{checked:m,className:"huge-spacer-top",onCheck:()=>e.onToggleSpecificSetting(!0),value:"specific"},Object(d.translate)("project_baseline.specific_setting"))),s.createElement("div",{className:"big-spacer-left big-spacer-right branch-baseline-setting-modal"},s.createElement("div",{className:"display-flex-row big-spacer-bottom",role:"radiogroup"},s.createElement(k.a,{disabled:!m,onSelect:e.onSelectSetting,selected:m&&"PREVIOUS_VERSION"===p}),s.createElement(C.a,{days:c,disabled:!m,isChanged:b,isValid:y,onChangeDays:e.onSelectDays,onSelect:e.onSelectSetting,selected:m&&"NUMBER_OF_DAYS"===p}),!n&&s.createElement(N,{disabled:!m,onSelect:e.onSelectSetting,selected:m&&"SPECIFIC_ANALYSIS"===p})),"SPECIFIC_ANALYSIS"===p&&s.createElement(G,{analysis:t||"",branch:"master",component:a,onSelectAnalysis:e.onSelectAnalysis})),s.createElement("div",{className:P("big-spacer-top",{invisible:!b})},s.createElement("p",{className:"spacer-bottom"},Object(d.translate)("baseline.next_analysis_notice")),s.createElement(l.a,{className:"spacer-right",loading:u}),s.createElement(f.SubmitButton,{disabled:u||!y||!b},Object(d.translate)("save")),s.createElement(f.ResetButtonLink,{className:"spacer-left",onClick:e.onCancel},Object(d.translate)("cancel"))))}function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,s=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(r)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}const X={type:"PREVIOUS_VERSION"};t.default=Object(a.connect)(e=>({branchesEnabled:Object(r.getAppState)(e).branchesEnabled,canAdmin:Object(r.getAppState)(e).canAdmin}))(class extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={days:"30",loading:!0,saving:!1},this.resetSetting=()=>{this.setState({saving:!0}),Object(u.c)({project:this.props.component.key}).then(()=>{this.setState({saving:!1,currentSetting:void 0,selected:void 0})},()=>{this.setState({saving:!1})})},this.handleSelectAnalysis=e=>this.setState({analysis:e.key}),this.handleSelectDays=e=>this.setState({days:e}),this.handleCancel=()=>this.setState(e=>{let t=e.generalSetting,n=void 0===t?X:t,a=e.currentSetting,r=e.currentSettingValue;return this.getUpdatedState({generalSetting:n,currentSetting:a,currentSettingValue:r})}),this.handleSelectSetting=e=>this.setState({selected:e}),this.handleToggleSpecificSetting=e=>this.setState({overrideGeneralSetting:e}),this.handleSubmit=e=>{e.preventDefault();const t=this.props.component,n=this.state,a=n.analysis,r=n.days,s=n.selected;if(!n.overrideGeneralSetting)return void this.resetSetting();const i=Object(h.a)({type:s,analysis:a,days:r});s&&(this.setState({saving:!0}),Object(u.d)({project:t.key,type:s,value:i}).then(()=>{this.setState({saving:!1,currentSetting:s,currentSettingValue:i||void 0})},()=>{this.setState({saving:!1})}))}}componentDidMount(){this.mounted=!0,this.fetchLeakPeriodSetting()}componentWillUnmount(){this.mounted=!1}getUpdatedState(e){const t=e.currentSetting,n=e.currentSettingValue,a=e.generalSetting,r=!t&&"NUMBER_OF_DAYS"===a.type&&a.value||"30";return{loading:!1,currentSetting:t,currentSettingValue:n,generalSetting:a,selected:t||a.type,overrideGeneralSetting:Boolean(t),days:"NUMBER_OF_DAYS"===t&&n||r,analysis:"SPECIFIC_ANALYSIS"===t&&n||""}}fetchLeakPeriodSetting(){this.setState({loading:!0}),Promise.all([Object(u.a)(),Object(u.a)({branch:this.props.branchesEnabled?void 0:"master",project:this.props.component.key})]).then(e=>{let t=K(e,2),n=t[0],a=t[1];if(this.mounted){n.type||(n=X);const e=a.value,t=a.inherited?void 0:a.type||"PREVIOUS_VERSION";this.setState(this.getUpdatedState({generalSetting:n,currentSetting:t,currentSettingValue:e}))}},()=>{this.setState({loading:!1})})}renderHeader(){return s.createElement("header",{className:"page-header"},s.createElement("h1",{className:"page-title"},Object(d.translate)("project_baseline.page")),s.createElement("p",{className:"page-description"},s.createElement(i.FormattedMessage,{defaultMessage:Object(d.translate)("project_baseline.page.description"),id:"project_baseline.page.description",values:{link:s.createElement(c.Link,{to:"/documentation/project-administration/new-code-period/"},Object(d.translate)("project_baseline.page.description.link"))}}),s.createElement("br",null),this.props.canAdmin&&s.createElement(i.FormattedMessage,{defaultMessage:Object(d.translate)("project_baseline.page.description2"),id:"project_baseline.page.description2",values:{link:s.createElement(c.Link,{to:"/admin/settings?category=new_code_period"},Object(d.translate)("project_baseline.page.description2.link"))}})))}render(){const e=this.props,t=e.branchLikes,n=e.branchesEnabled,a=e.component,r=this.state,i=r.analysis,c=r.currentSetting,o=r.days,u=r.generalSetting,h=r.loading,m=r.currentSettingValue,g=r.overrideGeneralSetting,b=r.saving,y=r.selected;return s.createElement(s.Fragment,null,s.createElement(p.a,{suggestions:"project_baseline"}),s.createElement("div",{className:"page page-limited"},this.renderHeader(),h?s.createElement(l.a,null):s.createElement("div",{className:"panel-white project-baseline"},n&&s.createElement("h2",null,Object(d.translate)("project_baseline.default_setting")),u&&void 0!==g&&s.createElement(J,{analysis:i,branchesEnabled:n,component:a.key,currentSetting:c,currentSettingValue:m,days:o,generalSetting:u,onCancel:this.handleCancel,onSelectAnalysis:this.handleSelectAnalysis,onSelectDays:this.handleSelectDays,onSelectSetting:this.handleSelectSetting,onSubmit:this.handleSubmit,onToggleSpecificSetting:this.handleToggleSpecificSetting,overrideGeneralSetting:g,saving:b,selected:y}),u&&n&&s.createElement("div",{className:"huge-spacer-top branch-baseline-selector"},s.createElement("hr",null),s.createElement("h2",null,Object(d.translate)("project_baseline.configure_branches")),s.createElement(H,{branchLikes:t,component:a,inheritedSetting:c?{type:c,value:m}:u})))))}})},332:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var a=n(2),r=n(350);function s(e){let t=e.suggestions;return a.createElement(r.a.Consumer,null,e=>{let n=e.addSuggestions,r=e.removeSuggestions;return a.createElement(i,{addSuggestions:n,removeSuggestions:r,suggestions:t})})}class i extends a.PureComponent{componentDidMount(){this.props.addSuggestions(this.props.suggestions)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.props.removeSuggestions(this.props.suggestions),this.props.addSuggestions(e.suggestions))}componentWillUnmount(){this.props.removeSuggestions(this.props.suggestions)}render(){return null}}},342:function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return o});var a=n(2),r=n(304),s=n(29);const i={year:"numeric",month:"short",day:"2-digit"},c={year:"numeric",month:"long",day:"numeric"};function o(e){let t=e.children,n=e.date,o=e.long;return a.createElement(r.FormattedDate,Object.assign({value:Object(s.parseDate)(n)},o?c:i),t)}},344:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return c});var a=n(2),r=n(304),s=n(29);const i={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"};function c(e){let t=e.children,n=e.date;return a.createElement(r.FormattedDate,Object.assign({value:Object(s.parseDate)(n)},i),t)}},481:function(e,t,n){"use strict";n.d(t,"c",function(){return v}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return S}),n.d(t,"d",function(){return E}),n.d(t,"e",function(){return _}),n.d(t,"f",function(){return N}),n.d(t,"g",function(){return C}),n.d(t,"h",function(){return k}),n.d(t,"i",function(){return x}),n.d(t,"p",function(){return A}),n.d(t,"q",function(){return P}),n.d(t,"r",function(){return D}),n.d(t,"s",function(){return I}),n.d(t,"t",function(){return w}),n.d(t,"v",function(){return R}),n.d(t,"j",function(){return F}),n.d(t,"y",function(){return L}),n.d(t,"o",function(){return V}),n.d(t,"k",function(){return B}),n.d(t,"l",function(){return T}),n.d(t,"m",function(){return M}),n.d(t,"n",function(){return U}),n.d(t,"u",function(){return G}),n.d(t,"w",function(){return q}),n.d(t,"x",function(){return z});var a=n(325),r=n.n(a),s=n(612),i=n.n(s),c=n(397),o=n.n(c),l=n(645),d=n.n(l),u=n(746),p=n.n(u),h=n(415),m=n(29),g=n(5),b=n(413),y=n(30);const v=["VERSION","QUALITY_GATE","QUALITY_PROFILE","OTHER"],f=["QUALITY_GATE","DEFINITION_CHANGE","OTHER"],S="issues",E=["issues","coverage","duplications","custom"],j={issues:["bugs","code_smells","vulnerabilities"],coverage:["lines_to_cover","uncovered_lines"],duplications:["ncloc","duplicated_lines"]},O={issues:j.issues.concat(["reliability_rating","security_rating","sqale_rating"]),coverage:j.coverage.concat(["coverage"]),duplications:j.duplications.concat(["duplicated_lines_density"])},_="sonar_project_activity.graph",N="sonar_project_activity.graph.custom";function C(e,t){return e.category!==t.category||x(e,t)}function k(e,t){return!i()(e.customMetrics,t.customMetrics)}function x(e,t){return!i()(e.from,t.from)||!i()(e.to,t.to)}function A(e){return e.data.some(e=>Boolean(e.y||0===e.y))}function P(e){return e.some(e=>e.data&&e.data.length>1)}function D(e){return e.some(e=>e.data&&e.data.length>1&&A(e))}function I(e,t){return e.graph!==t.graph}function w(e){return"custom"===e}function R(e,t){return!i()(e.selectedDate,t.selectedDate)}function F(e,t,n,a){return a.length<=0||void 0===e?[]:r()(e.filter(e=>a.indexOf(e.metric)>=0).map(a=>{if("uncovered_lines"===a.metric&&!w(t))return function(e,t){const n=t.find(e=>"lines_to_cover"===e.metric);return{data:n?e.history.map((e,t)=>({x:e.date,y:Number(n.history[t].value)-Number(e.value)})):[],name:"covered_lines",translatedName:Object(g.translate)("project_activity.custom_metric.covered_lines"),type:"INT"}}(a,e);const r=function(e,t){return Array.isArray(t)?t.find(t=>t.key===e):t[e]}(a.metric,n);return{data:a.history.map(e=>({x:e.date,y:r&&"LEVEL"===r.type?e.value:Number(e.value)})),name:a.metric,translatedName:r?Object(g.getLocalizedMetricName)(r):a.metric,type:r?r.type:"INT"}}),e=>a.indexOf("covered_lines"===e.name?"uncovered_lines":e.name))}function L(e,t,n){return d()(o()(e,e=>e.type),e=>p()(e,n)).slice(0,t)}function V(e){return e.length>0?e[0].type:"INT"}function B(e,t){return e.reduce((e,n)=>{let a=e[e.length-1];const r=n.events.find(e=>"VERSION"===e.category);if(r){const t={version:r.name,key:r.key,byDay:{}};!a||Object.keys(a.byDay).length>0?e.push(t):e[e.length-1]=t,a=t}else a||(a={version:null,key:null,byDay:{}},e.push(a));const s=h(Object(m.parseDate)(n.date)).getTime().toString();let i=!0;if(t.category||t.from||t.to){const e=!t.from||n.date>=t.from,a=!t.to||n.date<=t.to,r=!t.category||null!=n.events.find(e=>e.category===t.category);i=e&&a&&r}return i&&(a.byDay[s]||(a.byDay[s]=[]),a.byDay[s].push(n)),e},[])}function T(e,t){return w(e)?t:j[e]}function M(e,t){return w(e)?t:O[e]}function U(e){const t=Object(y.get)(N,e);return{graph:Object(y.get)(_,e)||"issues",customGraphs:t?t.split(","):[]}}function Y(e){const t=Object(b.parseAsString)(e);return E.includes(t)?t:S}function G(e){return{category:Object(b.parseAsString)(e.category),customMetrics:Object(b.parseAsArray)(e.custom_metrics,b.parseAsString),from:Object(b.parseAsDate)(e.from),graph:Y(e.graph),project:Object(b.parseAsString)(e.id),to:Object(b.parseAsDate)(e.to),selectedDate:Object(b.parseAsDate)(e.selected_date)}}function q(e){return Object(b.cleanQuery)({category:Object(b.serializeString)(e.category),from:Object(b.serializeDate)(e.from),project:Object(b.serializeString)(e.project),to:Object(b.serializeDate)(e.to)})}function z(e){return Object(b.cleanQuery)({category:Object(b.serializeString)(e.category),custom_metrics:Object(b.serializeStringArray)(e.customMetrics),from:Object(b.serializeDate)(e.from),graph:(t=e.graph,t===S?void 0:t),id:Object(b.serializeString)(e.project),to:Object(b.serializeDate)(e.to),selected_date:Object(b.serializeDate)(e.selectedDate)});var t}},580:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var a=n(2),r=n(304),s=n(29);const i={hour:"numeric",minute:"numeric"},c={hour:"numeric",minute:"numeric",second:"numeric"};function o(e){let t=e.children,n=e.date,o=e.long;return a.createElement(r.FormattedTime,Object.assign({value:Object(s.parseDate)(n)},o?c:i),t)}},599:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var a=n(2),r=n(404),s=n.n(r),i=n(519),c=n.n(i),o=n(328);function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function d(e){let t=e.branchLike,n=l(e,["branchLike"]);return Object(o.h)(t)?a.createElement(c.a,Object.assign({},n)):a.createElement(s.a,Object.assign({},n))}},697:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n(2);const r=a.createContext({branchLike:void 0,component:void 0})},749:function(e,t,n){"use strict";n.d(t,"e",function(){return s}),n.d(t,"b",function(){return i}),n.d(t,"d",function(){return c}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return l});var a=n(8),r=n(321);function s(e){return Object(a.getJSON)("/api/project_analyses/search",e).catch(r.a)}function i(e,t,n,s){const i={analysis:e,name:t};return n&&(i.category=n),s&&(i.description=s),Object(a.postJSON)("/api/project_analyses/create_event",i).then(e=>e.event,r.a)}function c(e){return Object(a.post)("/api/project_analyses/delete_event",{event:e}).catch(r.a)}function o(e,t,n){const s={event:e};return t&&(s.name=t),n&&(s.description=n),Object(a.postJSON)("/api/project_analyses/update_event",s).then(e=>e.event,r.a)}function l(e){return Object(a.post)("/api/project_analyses/delete",{analysis:e}).catch(r.a)}},751:function(e,t,n){"use strict";n.d(t,"b",function(){return v}),n.d(t,"a",function(){return f});var a=n(309),r=n(2),s=n(304),i=n(28),c=n(310),o=n(404),l=n.n(o),d=n(334),u=n.n(d),p=n(494),h=n.n(p),m=n(5),g=n(402),b=n(328),y=n(320);function v(e){return"DEFINITION_CHANGE"===e.category&&void 0!==e.definitionChange}class f extends r.PureComponent{constructor(){super(...arguments),this.state={expanded:!1},this.stopPropagation=e=>{e.stopPropagation()},this.toggleProjectsList=()=>{this.setState(e=>({expanded:!e.expanded}))},this.renderProjectLink=(e,t)=>r.createElement(i.Link,{onClick:this.stopPropagation,title:e.name,to:Object(y.s)(e.key,t)},Object(g.limitComponentName)(e.name,28)),this.renderBranch=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(m.translate)("branches.main_branch");return r.createElement("span",{className:"nowrap",title:e},r.createElement(l.a,{className:"little-spacer-left text-text-top"}),e)}}renderProjectChange(e){const t=!this.props.branchLike||Object(b.g)(this.props.branchLike);if("ADDED"===e.changeType){const n=t?"event.definition_change.added":"event.definition_change.branch_added";return r.createElement("div",{className:"text-ellipsis"},r.createElement(s.FormattedMessage,{defaultMessage:Object(m.translate)(n),id:n,values:{project:this.renderProjectLink(e,e.branch),branch:this.renderBranch(e.branch)}}))}if("REMOVED"===e.changeType){const n=t?"event.definition_change.removed":"event.definition_change.branch_removed";return r.createElement("div",{className:"text-ellipsis"},r.createElement(s.FormattedMessage,{defaultMessage:Object(m.translate)(n),id:n,values:{project:this.renderProjectLink(e,e.branch),branch:this.renderBranch(e.branch)}}))}return"BRANCH_CHANGED"===e.changeType?r.createElement(s.FormattedMessage,{defaultMessage:Object(m.translate)("event.definition_change.branch_replaced"),id:"event.definition_change.branch_replaced",values:{project:this.renderProjectLink(e,e.newBranch),oldBranch:this.renderBranch(e.oldBranch),newBranch:this.renderBranch(e.newBranch)}}):null}render(){const e=this.props.event,t=this.state.expanded;return r.createElement("div",{className:"project-activity-event-inner"},r.createElement("div",{className:"project-activity-event-inner-main"},r.createElement(h.a,{className:a("project-activity-event-icon","little-spacer-right",e.category)}),r.createElement("div",{className:"project-activity-event-inner-text flex-1"},r.createElement("span",{className:"note little-spacer-right"},Object(m.translate)("event.category",e.category))),r.createElement(c.ResetButtonLink,{className:"project-activity-event-inner-more-link",onClick:this.toggleProjectsList,stopPropagation:!0},t?Object(m.translate)("hide"):Object(m.translate)("more"),r.createElement(u.a,{className:"little-spacer-left",turned:t}))),t&&r.createElement("ul",{className:"project-activity-event-inner-more-content"},e.definitionChange.projects.map(e=>r.createElement("li",{className:"display-flex-center little-spacer-top",key:e.key},this.renderProjectChange(e)))))}}},752:function(e,t,n){"use strict";n.d(t,"b",function(){return b}),n.d(t,"a",function(){return y});var a=n(309),r=n(2),s=n(304),i=n(28),c=n(310),o=n(334),l=n.n(o),d=n(494),u=n.n(d),p=n(366),h=n.n(p),m=n(5),g=n(320);function b(e){return"QUALITY_GATE"===e.category&&void 0!==e.qualityGate}class y extends r.PureComponent{constructor(){super(...arguments),this.state={expanded:!1},this.stopPropagation=e=>{e.stopPropagation()},this.toggleProjectsList=()=>{this.setState(e=>({expanded:!e.expanded}))}}render(){const e=this.props.event,t=this.state.expanded;return r.createElement("div",{className:"project-activity-event-inner"},r.createElement("div",{className:"project-activity-event-inner-main"},r.createElement(u.a,{className:a("project-activity-event-icon","little-spacer-right",e.category)}),r.createElement("div",{className:"project-activity-event-inner-text flex-1"},r.createElement("span",{className:"note little-spacer-right"},Object(m.translate)("event.category",e.category),":"),e.qualityGate.stillFailing?r.createElement(s.FormattedMessage,{defaultMessage:Object(m.translate)("event.quality_gate.still_x"),id:"event.quality_gate.still_x",values:{status:r.createElement(h.a,{level:e.qualityGate.status,small:!0})}}):r.createElement(h.a,{level:e.qualityGate.status,small:!0})),e.qualityGate.failing.length>0&&r.createElement(c.ResetButtonLink,{className:"project-activity-event-inner-more-link",onClick:this.toggleProjectsList,stopPropagation:!0},t?Object(m.translate)("hide"):Object(m.translate)("more"),r.createElement(l.a,{className:"little-spacer-left",turned:t}))),t&&r.createElement("ul",{className:"project-activity-event-inner-more-content"},e.qualityGate.failing.map(t=>r.createElement("li",{className:"display-flex-center little-spacer-top",key:t.key},r.createElement(h.a,{className:"little-spacer-right",level:e.qualityGate.status,small:!0}),r.createElement("div",{className:"flex-1 text-ellipsis"},r.createElement(i.Link,{onClick:this.stopPropagation,title:t.name,to:Object(g.s)(t.key,t.branch)},t.name))))))}}},783:function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"d",function(){return i}),n.d(t,"c",function(){return c}),n.d(t,"b",function(){return o});var a=n(8),r=n(321);function s(e){return Object(a.getJSON)("/api/new_code_periods/show",e).catch(r.a)}function i(e){return Object(a.post)("/api/new_code_periods/set",e).catch(r.a)}function c(e){return Object(a.post)("/api/new_code_periods/unset",e).catch(r.a)}function o(e){return Object(a.getJSON)("/api/new_code_periods/list",e).catch(r.a)}},784:function(e,t,n){"use strict";function a(e){const t=parseInt(e,10);return!(e.length<1||isNaN(t)||t<1||String(t)!==e)}function r(e){let t=e.analysis,n=e.days;switch(e.type){case"NUMBER_OF_DAYS":return n;case"SPECIFIC_ANALYSIS":return t;default:return}}function s(e){const t=e.analysis,n=void 0===t?"":t,r=e.currentSetting,s=e.currentSettingValue,i=e.days,c=e.selected,o=e.overrideGeneralSetting;let l;return{isChanged:l=r||void 0===o?!1===o||c!==r||"NUMBER_OF_DAYS"===c&&i!==s||"SPECIFIC_ANALYSIS"===c&&n!==s:o,isValid:!1===o||"PREVIOUS_VERSION"===c||"SPECIFIC_ANALYSIS"===c&&n.length>0||"NUMBER_OF_DAYS"===c&&a(i)}}n.d(t,"b",function(){return a}),n.d(t,"a",function(){return r}),n.d(t,"c",function(){return s})},830:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var a=n(2),r=n(448),s=n.n(r),i=n(568),c=n.n(i),o=n(5);function l(e){const t=e.className,n=e.days,r=e.disabled,i=e.isChanged,l=e.isValid,d=e.onChangeDays,u=e.onSelect,p=e.selected;return a.createElement(s.a,{className:t,disabled:r,onClick:()=>u("NUMBER_OF_DAYS"),selected:p,title:Object(o.translate)("baseline.number_days")},a.createElement(a.Fragment,null,a.createElement("p",{className:"big-spacer-bottom"},Object(o.translate)("baseline.number_days.description")),p&&a.createElement(c.a,{error:void 0,id:"baseline_number_of_days",isInvalid:i&&!l,isValid:i&&l,label:Object(o.translate)("baseline.specify_days"),required:!0},a.createElement("input",{onChange:e=>d(e.currentTarget.value),type:"text",value:n}))))}},831:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var a=n(2),r=n(448),s=n.n(r),i=n(5);function c(e){const t=e.disabled,n=e.isDefault,r=e.onSelect,c=e.selected;return a.createElement(s.a,{disabled:t,onClick:()=>r("PREVIOUS_VERSION"),selected:c,title:Object(i.translate)("baseline.previous_version")+(n?" (".concat(Object(i.translate)("default"),")"):"")},a.createElement("p",null,Object(i.translate)("baseline.previous_version.description")))}}}]);
//# sourceMappingURL=304.m.4d987ac6.chunk.js.map