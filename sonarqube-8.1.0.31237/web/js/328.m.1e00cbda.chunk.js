(window.webpackJsonp=window.webpackJsonp||[]).push([[328],{1081:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),o=n(311);t.default=function(e){var t=e.className,n=e.fill,i=void 0===n?"currentColor":n,r=e.size;return s.createElement(o.default,{className:t,size:r},s.createElement("g",{fill:"none",fillRule:"evenodd"},s.createElement("path",{d:"M8 1v4H4",stroke:i,strokeWidth:"2",transform:"scale(-.83333 -.84583) rotate(45 7.66 -19.75)"}),s.createElement("path",{d:"M3 5.78h10v1.7H3z",fill:i}),s.createElement("path",{d:"M7.17 2.4h1.66v5.07H7.17z",fill:i}),s.createElement("g",null,s.createElement("path",{d:"M8.16 1.81V6.1H3.9",stroke:i,strokeWidth:"2",transform:"scale(.83333 .84583) rotate(45 -4.2 13.2)"}),s.createElement("path",{d:"M13 10.01H3v-1.7h10z",fill:i}),s.createElement("path",{d:"M8.83 13.4H7.17V9.15h1.66z",fill:i}))))}},1804:function(e,t,n){"use strict";n.r(t);var s=n(2),o=n(314),i=n.n(o),r=n(355),p=n(369),a=n(1198),l=n(1199),c=n(837),u=n(1080),h=n(664),d=n(328),m=n(309),f=n.n(m),g=n(852),y=n(1202),b=n(1081),L=n.n(b),v=n(5),x=n(429),P=n(1204),k=n(1079),O=n(1201);function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],s=!0,o=!1,i=void 0;try{for(var r,p=e[Symbol.iterator]();!(s=(r=p.next()).done)&&(n.push(r.value),!t||n.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==p.return||p.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}const E=5,I=5,w=11,j=9,B=50;function M(e,t){let n=C(e,2),s=n[0],o=n[1],i=C(t,2),r=i[0];return!(s>i[1]+w||o<r-w)}function D(e){return{component:e.component,textRange:e.textRange||{endLine:0,endOffset:0,startLine:0,startOffset:0}}}function R(e){const t=e.locations,n=e.issue;return(e.addIssueLocation?[D(n),...t]:t).reduce((e,t,s)=>{const o=Math.max(1,t.textRange.startLine-E),i=function(e){const t=e.issue,n=e.locationEnd,s=t.textRange&&t.textRange.endLine||0;return s&&s!==n?n+I:n+j}({issue:n,locationEnd:t.textRange.endLine});let r;return e=e.filter(e=>{if(M([e.start,e.end],[o,i])){let t=!1;return r||(r=e,t=!0),r.start=Math.min(o,e.start,r.start),r.end=Math.max(i,e.end,r.end),t}return!0}),void 0===r&&e.push({start:o,end:i,index:s}),e},[])}function T(e,t){let n,s="";const o=[];return e.forEach((e,i)=>{e.component!==s&&(n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){S(e,t,n[t])})}return e}({},t[e.component]||function(e){return{component:{key:e,measures:{},path:"",project:"",projectName:"",q:"FIL",uuid:""},sources:[]}}(e.component),{locations:[]}),o.push(n),s=e.component),e.index=i,n.locations.push(e)}),o}const N=32;class _ extends s.PureComponent{constructor(e){super(e),this.doScroll=e=>{this.props.scroll&&this.props.scroll(e);const t=this.snippetNodeRef.current;t&&Object(x.scrollHorizontally)(e,{leftOffset:N,rightOffset:t.getBoundingClientRect().width-N,parent:t})},this.scrollToLastExpandedRow=()=>{if(this.props.scroll){const e=this.snippetNodeRef.current;if(!e)return;const t=e.querySelectorAll("tr"),n=t[t.length-1];this.props.scroll(n,100)}},this.expandBlock=e=>()=>this.props.expandBlock(this.props.index,e).then(()=>{"down"===e&&this.scrollToLastExpandedRow()}),this.snippetNodeRef=s.createRef()}renderLine(e){let t=e.displayDuplications,n=e.index,o=e.issuesForLine,i=e.issueLocations,r=e.line,p=e.snippet,a=e.symbols,l=e.verticalBuffer;const c=Object(k.b)(r,this.props.locations),u=this.props,h=u.duplications,d=u.duplicationsByLine,m=h?h.length:0,f=m&&d&&d[r.line]||[],g=o.some(e=>e.key===this.props.issue.key);return s.createElement(P.a,{branchLike:this.props.branchLike,displayAllIssues:!1,displayCoverage:!0,displayDuplications:t,displayIssues:!g||o.length>1,displayLocationMarkers:!0,duplications:f,duplicationsCount:m,highlighted:!1,highlightedLocationMessage:Object(O.b)(this.props.highlightedLocationMessage,c),highlightedSymbols:Object(O.a)(a,this.props.highlightedSymbols),issueLocations:i,issuePopup:this.props.issuePopup,issues:o,key:r.line,last:!1,line:r,linePopup:this.props.linePopup,loadDuplications:this.props.loadDuplications,onIssueChange:this.props.onIssueChange,onIssuePopupToggle:this.props.onIssuePopupToggle,onIssueSelect:()=>{},onIssueUnselect:()=>{},onIssuesClose:this.props.handleCloseIssues,onIssuesOpen:this.props.handleOpenIssues,onLinePopupToggle:this.props.handleLinePopupToggle,onLocationSelect:this.props.onLocationSelect,onSymbolClick:this.props.handleSymbolClick,openIssues:this.props.openIssuesByLine[r.line],previousLine:n>0?p[n-1]:void 0,renderDuplicationPopup:this.props.renderDuplicationPopup,scroll:this.doScroll,secondaryIssueLocations:c,selectedIssue:Object(O.c)(this.props.issue.key,o),verticalBuffer:l})}render(){const e=this.props,t=e.component,n=e.issue,o=e.issuesByLine,i=void 0===o?{}:o,r=e.last,p=e.locationsByLine,a=e.openIssuesByLine,l=e.snippet,u=t.measures&&t.measures.lines&&parseInt(t.measures.lines,10),h=Object(c.e)(l),d=l[l.length-1].line,m=n.textRange?n.textRange.endLine:n.line,g=Math.max(...Object.keys(i).map(e=>parseInt(e,10)).filter(e=>(function(e,t){return e>=t[0].line&&e<=t[t.length-1].line})(e,l)&&(e===m||a[e]))),y=r?Math.max(0,j-(d-g)):0,b=l.some(e=>!!e.duplicated);return s.createElement("div",{className:"source-viewer-code snippet",ref:this.snippetNodeRef},s.createElement("div",null,l[0].line>1&&s.createElement("div",{className:"expand-block expand-block-above"},s.createElement("button",{"aria-label":Object(v.translate)("source_viewer.expand_above"),onClick:this.expandBlock("up"),type:"button"},s.createElement(L.a,null))),s.createElement("table",{className:f()("source-table",{"expand-up":l[0].line>1,"expand-down":!u||l[l.length-1].line<u})},s.createElement("tbody",null,l.map((e,t)=>this.renderLine({displayDuplications:b,index:t,issuesForLine:i[e.line]||[],issueLocations:p[e.line]||[],line:e,snippet:l,symbols:h[e.line],verticalBuffer:t===l.length-1?y:0})))),(!u||l[l.length-1].line<u)&&s.createElement("div",{className:"expand-block expand-block-below"},s.createElement("button",{"aria-label":Object(v.translate)("source_viewer.expand_below"),onClick:this.expandBlock("down"),type:"button"},s.createElement(L.a,null)))))}}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){H(e,t,n[t])})}return e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class z extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.rootNodeRef=s.createRef(),this.state={additionalLines:{},highlightedSymbols:[],loading:!1,openIssuesByLine:{},snippets:[]},this.expandBlock=(e,t)=>{const n=this.props,s=n.branchLike,o=n.snippetGroup.component.key,i=this.state.snippets.find(t=>t.index===e);if(!i)return Promise.reject();const p=B+w-1,a="up"===t?{from:Math.max(1,i.start-p),to:i.start-1}:{from:i.end+1,to:i.end+p};return Object(r.u)(F({key:o},a,Object(d.d)(s))).then(e=>e.reduce((e,t)=>(t.coverageStatus=Object(g.a)(t),e[t.line]=t,e),{})).then(n=>this.animateBlockExpansion(e,t,n))},this.expandComponent=()=>{const e=this.props,t=e.branchLike,n=e.snippetGroup.component.key;this.setState({loading:!0}),Object(r.u)(F({key:n},Object(d.d)(t))).then(e=>{this.mounted&&this.setState(t=>{return{additionalLines:F({},t.additionalLines,e),loading:!1,snippets:[{start:0,end:e[e.length-1].line,index:-1}]}})},()=>{this.mounted&&this.setState({loading:!1})})},this.handleLinePopupToggle=e=>{this.props.onLinePopupToggle(F({},e,{component:this.props.snippetGroup.component.key}))},this.handleOpenIssues=e=>{this.setState(t=>({openIssuesByLine:F({},t.openIssuesByLine,{[e.line]:!0})}))},this.handleCloseIssues=e=>{this.setState(t=>({openIssuesByLine:F({},t.openIssuesByLine,{[e.line]:!1})}))},this.handleSymbolClick=e=>{this.setState({highlightedSymbols:e})},this.loadDuplications=e=>{this.props.loadDuplications(this.props.snippetGroup.component.key,e)},this.renderDuplicationPopup=(e,t)=>this.props.renderDuplicationPopup(this.props.snippetGroup.component,e,t)}componentDidMount(){this.mounted=!0,this.createSnippetsFromProps()}componentWillUnmount(){this.mounted=!1}createSnippetsFromProps(){const e=R({locations:this.props.snippetGroup.locations,issue:this.props.issue,addIssueLocation:this.props.issue.secondaryLocations.length>0});this.setState({snippets:e})}getNodes(e){const t=this.rootNodeRef.current;if(!t)return;const n=t.querySelector("#snippet-wrapper-".concat(e));if(!n)return;const s=n.querySelector(".snippet");if(!s)return;const o=s.firstChild;return o?{wrapper:s,table:o}:void 0}cleanDom(e){const t=this.getNodes(e);if(!t)return;const n=t.wrapper;t.table.style.marginTop="",n.style.maxHeight=""}setMaxHeight(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=this.getNodes(e);if(!s)return;const o=s.wrapper,i=s.table,r=void 0!==t?t:i.getBoundingClientRect().height;if(n){const e=o.getBoundingClientRect().height;i.style.transition="none",i.style.marginTop="".concat(e-r,"px"),setTimeout(()=>{i.style.transition="",i.style.marginTop="0px",o.style.maxHeight="".concat(r+20,"px")},0)}else o.style.maxHeight="".concat(r+20,"px")}animateBlockExpansion(e,t,n){if(this.mounted){const s=this.state.snippets,o=function(e){let t=e.direction,n=e.snippetIndex,s=e.snippets;const o=s.find(e=>e.index===n);if(!o)throw new Error("Snippet ".concat(n," not found"));return o.start=Math.max(0,o.start-("up"===t?B:0)),o.end+="down"===t?B:0,s.map(e=>e.index===n?o:(M([e.start,e.end],[o.start,o.end])&&(o.start=Math.min(e.start,o.start),o.end=Math.max(e.end,o.end),e.toDelete=!0),e))}({direction:t,snippetIndex:e,snippets:s}),i=o.filter(e=>e.toDelete);return i.forEach(e=>this.setMaxHeight(e.index)),this.setMaxHeight(e),new Promise(s=>{this.setState(e=>{let t=e.additionalLines,s=e.snippets;return{additionalLines:F({},t,n),snippets:s}},()=>{i.forEach(e=>{this.setMaxHeight(e.index,0)}),this.setMaxHeight(e,void 0,"up"===t),setTimeout(()=>{this.setState({snippets:o.filter(e=>!e.toDelete)},s),this.cleanDom(e)},200)})})}return Promise.resolve()}renderSnippet(e){let t=e.index,n=e.issuesByLine,o=e.last,i=e.locationsByLine,r=e.snippet;return s.createElement(_,{branchLike:this.props.branchLike,component:this.props.snippetGroup.component,expandBlock:this.expandBlock,handleCloseIssues:this.handleCloseIssues,handleLinePopupToggle:this.handleLinePopupToggle,handleOpenIssues:this.handleOpenIssues,handleSymbolClick:this.handleSymbolClick,highlightedLocationMessage:this.props.highlightedLocationMessage,highlightedSymbols:this.state.highlightedSymbols,index:t,issue:this.props.issue,issuePopup:this.props.issuePopup,issuesByLine:n,last:o,linePopup:this.props.linePopup,loadDuplications:this.loadDuplications,locations:this.props.locations,locationsByLine:i,onIssueChange:this.props.onIssueChange,onIssuePopupToggle:this.props.onIssuePopupToggle,onLocationSelect:this.props.onLocationSelect,openIssuesByLine:this.state.openIssuesByLine,renderDuplicationPopup:this.renderDuplicationPopup,scroll:this.props.scroll,snippet:r})}render(){const e=this.props,t=e.branchLike,n=e.duplications,o=e.issue,i=e.issuesByLine,r=e.last,p=e.snippetGroup,a=this.state,l=a.additionalLines,u=a.loading,h=a.snippets,d=Object(c.d)([o]),f=1===h.length&&p.component.measures&&h[0].end-h[0].start===parseInt(p.component.measures.lines||"",10),g=function(e,t){return e.map(e=>{const n=[];for(let s=e.start;s<=e.end;s++)t[s]&&n.push(t[s]);return n}).filter(e=>e.length>0)}(h,F({},p.sources,l));return s.createElement("div",{className:m("component-source-container",{"source-duplications-expanded":n&&n.length>0}),ref:this.rootNodeRef},s.createElement(y.a,{branchLike:t,expandable:!f,loading:u,onExpand:this.expandComponent,sourceViewerFile:p.component}),g.map((e,t)=>s.createElement("div",{id:"snippet-wrapper-".concat(h[t].index),key:h[t].index},this.renderSnippet({snippet:e,index:h[t].index,issuesByLine:r?i:{},locationsByLine:r&&t===h.length-1?d:{},last:r&&t===h.length-1}))))}}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"default",function(){return A});class A extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={components:{},duplicationsByLine:{},loading:!0},this.fetchDuplications=(e,t)=>{Object(r.q)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){G(e,t,n[t])})}return e}({key:e},Object(d.d)(this.props.branchLike))).then(n=>{this.mounted&&this.setState(s=>({duplicatedFiles:n.files,duplications:n.duplications,duplicationsByLine:Object(c.a)(n.duplications),linePopup:1===n.duplications.length?{component:e,index:0,line:t.line,name:"duplications"}:s.linePopup}))},()=>{})},this.handleIssuePopupToggle=(e,t,n)=>{this.setState(s=>{const o=s.issuePopup&&s.issuePopup.name===t&&s.issuePopup.issue===e;return!1===n||o?!0!==n&&o?{issuePopup:void 0}:null:{issuePopup:{issue:e,name:t}}})},this.handleLinePopupToggle=e=>{let t=e.component,n=e.index,s=e.line,o=e.name,i=e.open;this.setState(e=>{const r=void 0!==e.linePopup&&e.linePopup.line===s&&e.linePopup.name===o&&e.linePopup.component===t&&e.linePopup.index===n;return!1===i||r?!0!==i&&r?{linePopup:void 0}:null:{linePopup:{component:t,index:n,line:s,name:o}}})},this.handleCloseLinePopup=()=>{this.setState({linePopup:void 0})},this.renderDuplicationPopup=(e,t,n)=>{const o=this.state,i=o.duplicatedFiles,r=o.duplications;if(!e||!i)return null;const p=Object(l.b)(r,t);return s.createElement(h.a.Consumer,null,t=>{let o=t.openComponent;return s.createElement(a.a,{blocks:Object(l.a)(p,n),branchLike:this.props.branchLike,duplicatedFiles:i,inRemovedComponent:Object(l.c)(p),onClose:this.handleCloseLinePopup,openComponent:o,sourceViewerFile:e})})}}componentDidMount(){this.mounted=!0,this.fetchIssueFlowSnippets(this.props.issue.key)}componentWillReceiveProps(e){e.issue.key!==this.props.issue.key&&this.fetchIssueFlowSnippets(e.issue.key)}componentWillUnmount(){this.mounted=!1}fetchIssueFlowSnippets(e){this.setState({loading:!0}),Object(p.h)(e).then(e=>{this.mounted&&(this.setState({components:e,issuePopup:void 0,linePopup:void 0,loading:!1}),this.props.onLoaded&&this.props.onLoaded())},()=>{this.mounted&&this.setState({loading:!1})})}render(){if(this.state.loading)return s.createElement("div",null,s.createElement(i.a,null));const e=this.state,t=e.components,n=e.duplications,o=e.duplicationsByLine,r=e.linePopup,p=Object(c.b)(this.props.issues),a=T(this.props.locations,t);return s.createElement("div",null,a.map((e,t)=>{let i={};return r&&e.component.key===r.component&&(i={duplications:n,duplicationsByLine:o,linePopup:{index:r.index,line:r.line,name:r.name}}),s.createElement(u.a.Provider,{key:"".concat(this.props.issue.key,"-").concat(this.props.selectedFlowIndex||0,"-").concat(t),value:{branchLike:this.props.branchLike,file:e.component}},s.createElement(z,Object.assign({branchLike:this.props.branchLike,highlightedLocationMessage:this.props.highlightedLocationMessage,issue:this.props.issue,issuePopup:this.state.issuePopup,issuesByLine:p[e.component.key]||{},last:t===a.length-1,loadDuplications:this.fetchDuplications,locations:e.locations||[],onIssueChange:this.props.onIssueChange,onIssuePopupToggle:this.handleIssuePopupToggle,onLinePopupToggle:this.handleLinePopupToggle,onLocationSelect:this.props.onLocationSelect,renderDuplicationPopup:this.renderDuplicationPopup,scroll:this.props.scroll,snippetGroup:e},i)))}))}}},397:function(e,t,n){var s=n(464),o=n(400),i=Object.prototype.hasOwnProperty,r=o(function(e,t,n){i.call(e,n)?e[n].push(t):s(e,n,[t])});e.exports=r},520:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(309),o=n(2),i=n(335),r=n(311);t.default=function(e){var t=e.className,n=e.favorite,p=e.fill,a=e.size;return o.createElement(i.ThemeConsumer,null,function(e){return o.createElement(r.default,{className:s("icon-outline",{"is-filled":n},t),size:a,style:{color:p||e.colors.orange}},o.createElement("g",{transform:"matrix(0.988024,0,0,0.988024,0.0957953,0.717719)"},o.createElement("path",{d:"M15.428,5.777C15.428,5.908 15.35,6.051 15.195,6.205L11.954,9.366L12.722,13.83C12.728,13.872 12.731,13.932 12.731,14.009C12.731,14.134 12.7,14.24 12.637,14.326C12.575,14.412 12.484,14.455 12.365,14.455C12.252,14.455 12.133,14.42 12.008,14.348L7.999,12.241L3.99,14.348C3.859,14.42 3.74,14.455 3.633,14.455C3.508,14.455 3.414,14.412 3.352,14.326C3.289,14.24 3.258,14.134 3.258,14.009C3.258,13.973 3.264,13.914 3.276,13.83L4.044,9.366L0.794,6.205C0.645,6.045 0.57,5.902 0.57,5.777C0.57,5.557 0.737,5.42 1.07,5.366L5.552,4.714L7.561,0.652C7.674,0.408 7.82,0.286 7.999,0.286C8.177,0.286 8.323,0.408 8.436,0.652L10.445,4.714L14.927,5.366C15.261,5.42 15.427,5.557 15.427,5.777L15.428,5.777Z"})))})}},600:function(e,t,n){"use strict";var s,o=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(309),r=n(2),p=n(5),a=n(520),l=n(310),c=n(315),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.favorite,s=e.qualifier,o=e.toggleFavorite,u=n?p.translate("favorite.current",s):p.translate("favorite.check",s),h=p.translate("favorite.action",n?"remove":"add");return r.createElement(c.default,{overlay:u},r.createElement(l.ButtonLink,{"aria-label":h,className:i("favorite-link","link-no-underline",t),onClick:o},r.createElement(a.default,{favorite:n})))},t}(r.PureComponent);t.default=u},708:function(e,t,n){var s=n(370),o=n(709),i=n(441),r=n(710),p=i(function(e){var t=s(e,r);return t.length&&t[0]===e[0]?o(t):[]});e.exports=p},709:function(e,t,n){var s=n(656),o=n(689),i=n(690),r=n(370),p=n(660),a=n(657),l=Math.min;e.exports=function(e,t,n){for(var c=n?i:o,u=e[0].length,h=e.length,d=h,m=Array(h),f=1/0,g=[];d--;){var y=e[d];d&&t&&(y=r(y,p(t))),f=l(y.length,f),m[d]=!n&&(t||u>=120&&y.length>=120)?new s(d&&y):void 0}y=e[0];var b=-1,L=m[0];e:for(;++b<u&&g.length<f;){var v=y[b],x=t?t(v):v;if(v=n||0!==v?v:0,!(L?a(L,x):c(g,x,n))){for(d=h;--d;){var P=m[d];if(!(P?a(P,x):c(e[d],x,n)))continue e}L&&L.push(x),g.push(v)}}return g}},710:function(e,t,n){var s=n(465);e.exports=function(e){return s(e)?e:[]}},802:function(e,t){e.exports=function(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}}}]);
//# sourceMappingURL=328.m.1e00cbda.chunk.js.map